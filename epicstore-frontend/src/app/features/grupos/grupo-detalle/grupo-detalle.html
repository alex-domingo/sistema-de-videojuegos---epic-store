<header class="header">
    <h2>Grupo #{{ idGrupo() }}</h2>
    <a routerLink="/grupos" class="back">← Volver</a>
</header>

<p *ngIf="cargando()">Cargando...</p>
<p class="error" *ngIf="error()">{{ error() }}</p>
<p class="ok" *ngIf="ok()">{{ ok() }}</p>

<section class="card">
    <h3>Miembros</h3>

    <p class="muted" *ngIf="!cargando() && miembros().length === 0">
        No hay miembros.
    </p>

    <ul class="ul" *ngIf="miembros().length">
        <li *ngFor="let m of miembros()">
            <b>{{ m.nickname }}</b>
            <span class="badge">{{ m.rol }}</span>
            <span class="muted">ID: {{ m.idUsuario }}</span>
        </li>
    </ul>
</section>

<section class="card">
    <h3>Agregar miembro</h3>

    <div class="row">
        <input type="number" placeholder="ID del usuario a agregar" [ngModel]="idUsuarioNuevo()"
            (ngModelChange)="idUsuarioNuevo.set($event); error.set(null)" />
        <button (click)="agregarMiembro()" [disabled]="agregando()">
            {{ agregando() ? 'Agregando...' : 'Agregar' }}
        </button>
    </div>

    <p class="muted">
        Nota: el backend valida dueño, límite 6, duplicado, etc.
    </p>
</section>

<section class="card">
    <h3>Prestar videojuego</h3>

    <ng-container *ngIf="esDueno(); else noDueno">
        <div class="row">
            <input type="number" placeholder="ID receptor (miembro)" [ngModel]="idReceptor()"
                (ngModelChange)="idReceptor.set($event); errorPrestamo.set(null)" />
            <input type="number" placeholder="ID videojuego" [ngModel]="idVideojuego()"
                (ngModelChange)="idVideojuego.set($event); errorPrestamo.set(null)" />
            <button (click)="prestar()" [disabled]="prestando()">
                {{ prestando() ? 'Prestando...' : 'Prestar' }}
            </button>
        </div>

        <p class="ok" *ngIf="okPrestamo()">{{ okPrestamo() }}</p>
        <p class="error" *ngIf="errorPrestamo()">{{ errorPrestamo() }}</p>

        <p class="muted">
            El backend valida: receptor miembro, dueño válido y que el receptor no tenga ya el juego.
        </p>
    </ng-container>

    <ng-template #noDueno>
        <p class="muted">Solo el dueño del grupo puede prestar videojuegos.</p>
    </ng-template>
</section>

<section class="card">
    <h3>Devolver préstamo</h3>

    <ng-container *ngIf="esDueno(); else noDuenoDev">
        <div class="row">
            <input type="number" placeholder="ID receptor" [ngModel]="idReceptorDevolver()"
                (ngModelChange)="idReceptorDevolver.set($event); errorDevolver.set(null)" />

            <input type="number" placeholder="ID videojuego" [ngModel]="idVideojuegoDevolver()"
                (ngModelChange)="idVideojuegoDevolver.set($event); errorDevolver.set(null)" />

            <button (click)="devolverPrestamo()" [disabled]="devolviendo()">
                {{ devolviendo() ? 'Devolviendo...' : 'Devolver' }}
            </button>
        </div>

        <p class="ok" *ngIf="okDevolver()">{{ okDevolver() }}</p>
        <p class="error" *ngIf="errorDevolver()">{{ errorDevolver() }}</p>
    </ng-container>

    <ng-template #noDuenoDev>
        <p class="muted">Solo el dueño puede devolver préstamos.</p>
    </ng-template>
</section>

<section class="card">
    <h3>Eliminar miembro</h3>

    <ng-container *ngIf="esDueno(); else noDuenoDelM">
        <div class="row">
            <input type="number" placeholder="ID usuario a eliminar" [ngModel]="idUsuarioEliminar()"
                (ngModelChange)="idUsuarioEliminar.set($event); errorEliminarMiembro.set(null)" />

            <button (click)="eliminarMiembro()" [disabled]="eliminandoMiembro()">
                {{ eliminandoMiembro() ? 'Eliminando...' : 'Eliminar miembro' }}
            </button>
        </div>

        <p class="ok" *ngIf="okEliminarMiembro()">{{ okEliminarMiembro() }}</p>
        <p class="error" *ngIf="errorEliminarMiembro()">{{ errorEliminarMiembro() }}</p>

        <p class="muted">No se puede eliminar al dueño del grupo.</p>
    </ng-container>

    <ng-template #noDuenoDelM>
        <p class="muted">Solo el dueño puede eliminar miembros.</p>
    </ng-template>
</section>

<section class="card danger">
    <h3>Eliminar grupo</h3>

    <ng-container *ngIf="esDueno(); else noDuenoDelG">
        <button (click)="eliminarGrupo()" [disabled]="eliminandoGrupo()">
            {{ eliminandoGrupo() ? 'Eliminando...' : 'Eliminar grupo' }}
        </button>

        <p class="ok" *ngIf="okEliminarGrupo()">{{ okEliminarGrupo() }}</p>
        <p class="error" *ngIf="errorEliminarGrupo()">{{ errorEliminarGrupo() }}</p>
    </ng-container>

    <ng-template #noDuenoDelG>
        <p class="muted">Solo el dueño puede eliminar el grupo.</p>
    </ng-template>
</section>