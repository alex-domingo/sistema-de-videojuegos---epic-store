<div class="page">
    <header class="header">
        <h2>Mi Biblioteca</h2>
        <a routerLink="/" class="back">← Volver al catálogo</a>
    </header>

    <p class="hint" *ngIf="resp()">
        {{ resp()!.mensaje }} (Total: {{ resp()!.total }})
    </p>

    <p class="ok" *ngIf="mensaje()">{{ mensaje() }}</p>

    <p *ngIf="cargando()">Cargando...</p>
    <p class="error" *ngIf="error()">{{ error() }}</p>

    <section class="grid" *ngIf="items().length">
        <div class="card" *ngFor="let v of items()">
            <div class="top">
                <a class="title-link" [routerLink]="['/videojuego', v.idVideojuego]">
                    {{ v.titulo }}
                </a>
                <div class="price">Q{{ v.precio }}</div>
            </div>

            <div class="meta">
                <div><b>Empresa:</b> {{ v.empresa }}</div>

                <div>
                    <b>Propiedad:</b>
                    <span class="badge">{{ v.tipoPropiedad }}</span>
                </div>

                <div>
                    <b>Instalación:</b>
                    <span class="badge" [class.ok]="v.estadoInstalacion === 'INSTALADO'">
                        {{ v.estadoInstalacion }}
                    </span>
                </div>

                <div class="muted">
                    Último cambio: {{ v.fechaUltimoCambioEstado }}
                </div>
            </div>

            <!-- botón instalar / desinstalar -->
            <div class="actions">
                <button class="btn" (click)="toggleInstalacion(v)" [disabled]="guardando()[v.idVideojuego]">
                    {{
                    guardando()[v.idVideojuego]
                    ? 'Guardando...'
                    : (v.estadoInstalacion === 'INSTALADO'
                    ? 'Desinstalar'
                    : 'Instalar')
                    }}
                </button>
            </div>

            <div class="img-hint">Portada: {{ v.imagenPortada }}</div>
        </div>
    </section>

    <p *ngIf="resp() && items().length === 0" class="muted">
        Tu biblioteca está vacía.
    </p>
</div>